<html>
    
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
        <script src="doek.js"></script>
        <script src="doek.canvas.js"></script>
        <script src="doek.layer.js"></script>
        <script src="doek.object.js"></script>
        <script src="doek.node.js"></script>
        <script src="doek.event.js"></script>
        <script src="doek.action.js"></script>
        <style type="text/css">
            #world {border: 1px solid black;}
        </style>
    </head>
    <body>
        <div id="world" data-width=500 data-height=500></div>
        
        <script>
            var d = new Doek.Canvas('world');
            var gridObject = d.addGrid();
            
            var hoverStyle = new Doek.Style('hover');
            hoverStyle.properties.strokeStyle = '#EE3030';
            gridObject.addStyle(hoverStyle);
            gridObject.clickable = true;
            var upStyle = new Doek.Style('upped');
            upStyle.properties.strokeStyle = '#101099';
            gridObject.addStyle(upStyle);
            
            gridObject.event.addEvent('mouseMove', function(caller, payload){
                this.applyStyle('hover');
                //console.log({'objectp': payload});
            });
            
            gridObject.parentLayer.event.addEvent('mouseMove', function(caller, payload){
                //this.applyStyle('hover');
                //console.log({'layerp': payload});
            });
            
            gridObject.event.addEvent('mouseOut', function(caller){
                this.applyStyle('ori');
            });
            
            gridObject.event.addEvent('mousedown', function(caller, payload){
                console.log(payload);
            });
            
            gridObject.event.addEvent('mouseup', function(callernode, payload){
                if (payload.originnode != callernode) {
                    callernode.applyStyle('upped');
                }
            });
            
            var layer = d.addLayer('main', 5);
            var obj = new Doek.Object(layer);
            
            var style = new Doek.Style('ori');
            style.properties.strokeStyle = '#DD0000';
            
            var mynode = obj.addLine(150, 60, 20, 300, style);
            layer.addObject(obj);
            
            d.setMode('edit');
            d.setAction('drawline');
            
            d.event.addEvent('mousemove', function (caller, payload) {
                var pos = payload.position;
                mynode.setEndpoint(pos);
                
            });
        </script>
    </body>
</html>
